name: live-test

on:
    push:
        branches:
            - master

env:
    CARGO_TERM_COLOR: always
    CARGO_UNSTABLE_SPARSE_REGISTRY: true
    CARGO_INCREMENTAL: 0

jobs:
    live:
        name: goerli live tests
        runs-on: ubuntu-latest
        env:
            GOERLI_RPC_URL: https://sepolia.infura.io/v3/fe24c1ff7cfb4ddabec77f512e60c5b6
            ETHERSCAN_API_KEY: ${{ secrets.ETHERSCAN_API_KEY }}
            TEST_PRIVATE_KEY: ${{ secrets.TEST_PRIVATE_KEY }}
        steps:
            - name: Checkout sources
              uses: actions/checkout@v3

            - name: Install toolchain
              uses: dtolnay/rust-toolchain@v1
              with:
                  toolchain: stable
                  profile: minimal
                  override: true

            - name: Install nextest
              uses: taiki-e/install-action@nextest
              
            - uses: Swatinem/rust-cache@v2
              with:
                  cache-on-failure: true
            - name: cargo nextest
              run: cargo nextest run -p foundry-cli -E "!test(~fork) & test(~live)"
              id: sepolia
